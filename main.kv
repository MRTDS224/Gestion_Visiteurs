#:kivy 2.3.1
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import dp kivy.metrics.dp
<TooltipMDIconButton>
    MDTooltipPlain:
        text: root.texte

    MDIconButton:
        icon: root.icon

<ToolMDActionButton>
    MDTooltipPlain:
        text: root.texte

<MainScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        padding: dp(16)
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.1
            spacing: dp(16)
            padding: dp(16)
            MDLabel:
                text: "Liste des visiteurs du jour"
                font_style: "Title"
                halign: "left"
                valign: "middle"
                bold: True
            
            MDTextField:
                id: year_filter
                mode: "outlined"
                size_hint: 0.23, None
                height: dp(48)
                on_focus: if self.focus: app.open_menu("year_filter")
                MDTextFieldHintText:
                    text: "Années"
            MDTextField:
                id: month_filter
                mode: "outlined"
                size_hint: 0.2, None
                height: dp(48)
                on_focus: if self.focus: app.open_menu("month_filter")
                MDTextFieldHintText:
                    text: "Mois"
            MDTextField:
                id: day_filter
                mode: "outlined"
                size_hint: 0.2, None
                height: dp(48)
                on_focus: if self.focus: app.open_menu("day_filter")
                MDTextFieldHintText:
                    text: "Jours"

            TooltipMDIconButton:
                icon: "filter"
                texte: "Filtrer"
                style: "tonal"
                theme_bg_color: "Custom"
                md_bg_color: "blue"
                theme_icon_color: "Custom"
                icon_color: "white"
                pos_hint: {"center_y": 0.5}
                on_release: app.filtrer(year_filter.text, month_filter.text, day_filter.text)

            TooltipMDIconButton:
                icon: "reload"
                texte: "Annuler le filtre"
                style: "tonal"
                theme_bg_color: "Custom"
                md_bg_color: "green"
                theme_icon_color: "Custom"
                icon_color: "white"
                pos_hint: {"center_y": 0.5}
                on_release: app.renitialiser_filtre()

            # MDIconButton:
            #     icon: "bell"
            #     style: "tonal"
            #     pos_hint: {"center_y": 0.5}
            #     on_release: root.open_notifications()
            #     MDBadge:
            #         id: ntf_badge
            #         text: ""
            #         badge_color: "red"
            #         badge_pos: ("right", "top")
            #         badge_animation: True
            #         badge_animation_type: "fade_in"
            TooltipMDIconButton:
                icon: "file-send"
                texte: "Partager un document ou une image"
                style: "tonal"
                theme_bg_color: "Custom"
                md_bg_color: "#BBDEFB"
                theme_icon_color: "Custom"
                icon_color: "#1E88E5"
                pos_hint: {"center_y": 0.5}
                on_release: app.open_document_filechooser()
            # MDIconButton:
            #     icon: "file-eye"
            #     style: "tonal"
            #     theme_bg_color: "Custom"
            #     md_bg_color: "#E0F2F1"
            #     theme_icon_color: "Custom"
            #     icon_color: "#004D40"
            #     pos_hint: {"center_y": 0.5}
            #     on_release: app.open_document_dialog()
            #     MDBadge:
            #         id: doc_badge
            #         text: ""
            #         badge_color: "red"
            #         badge_pos: ("right", "top")
            #         badge_animation: True
            #         badge_animation_type: "fade_in"
            TooltipMDIconButton:
                icon: "account"
                texte: "Votre espace compte"
                style: "tonal"
                theme_bg_color: "Custom"
                md_bg_color: "white"
                theme_icon_color: "Custom"
                icon_color: "black"
                pos_hint: {"center_y": 0.5}
                on_release: root.manager.current = "account"

        ScrollView:

            MDGridLayout:
                id: box
                cols: 5
                spacing: "12dp"
                padding: "12dp"
                adaptive_height: True

#
<DetailScreen>:
    MDTopAppBar:
        type: "small"
        pos_hint: {"top": 1}
        md_bg_color: self.theme_cls.backgroundColor

        MDTopAppBarLeadingButtonContainer:

            ToolMDActionButton:
                texte: "Retour à l'écran principal"
                icon: "arrow-left"
                on_release:
                    root.manager.current = "screen A"

        MDTopAppBarTitle:
            text: "Les informations du visiteur"
            halign: "center"

        MDTopAppBarTrailingButtonContainer:

            ToolMDActionButton:
                texte: "Sauvergarder les modifications"
                id: btn_save
                icon: "content-save"
                disabled: True
                md_bg_color: "#a7d9adff"
                theme_icon_color: "Custom"
                icon_color: "#10b480ff"
                on_release: app.enregistrer_modifications()
            ToolMDActionButton:
                texte: "Annuler les modifications"
                id: btn_cancel
                icon: "cancel"
                disabled: True
                md_bg_color: "#FFCDD2"
                theme_icon_color: "Custom"
                icon_color: "#C62828"
                on_release: app.annuler_modifications()
            ToolMDActionButton:
                texte: "Supprimer le visiteur"
                id: btn_delete
                icon: "trash-can-outline"
                md_bg_color: "#FFCDD2"
                theme_icon_color: "Custom"
                icon_color: "#C62828"
                on_release: app.delete_visitor()
            ToolMDActionButton:
                texte: "Partager l'image du visiteur par WhatsApp"
                id: btn_share
                icon: "share"
                md_bg_color: "#BBDEFB"
                theme_icon_color: "Custom"
                icon_color: "#1E88E5"
                on_release: app.envoyer_par_whatsapp("visiteur")
    MDBoxLayout:
        orientation: 'vertical'
        padding: "20dp"
        spacing: "20dp"
        size_hint: .3, .5
        pos_hint: {"top": .75}
        FitImage:
            id: image
            source: ""
            allow_stretch: True
            keep_ratio: True
            size_hint: None, None
            size: dp(300), dp(300)

        MDButton:
            style: "outlined"
            on_release: app.open_image_filechooser()
            MDButtonText:
                text: "Modifier  l'image"
            MDButtonIcon:
                icon: "pencil"
    
    MDGridLayout:
        cols: 2
        size_hint_x: .6 
        pos_hint: {"top": .93, "x": .4}
        spacing: "10dp"
        padding: "20dp"
        adaptive_height: True
        MDLabel:
            size_hint: .4, None
            height : dp(40)
            text: "Numéro de Téléphone"    
        MDTextField:
            id: phone_number
            on_text: app.activer_boutons_modification()
            size_hint: .6, None
            height : dp(40)

        MDLabel:
            size_hint: .2, None
            height : dp(40)
            text: "Lieu de naissance"    
        MDTextField:
            id: place_of_birth
            on_text: app.activer_boutons_modification()
            size_hint: .3, None
            height : dp(40)            
            
        MDLabel:
            size_hint: .4, None
            height : dp(40)
            text: "Le motif"  
        MDTextField:
            id: motif
            on_text: app.activer_boutons_modification()
            size_hint: .6, None
            height : dp(40)
            on_focus: if self.focus: app.open_menu("motif")
            
        MDLabel:
            size_hint: .4, None
            height : dp(40)
            text: "La date"
        MDTextField:
            id: date
            on_text: app.activer_boutons_modification()
            size_hint: .6, None
            height : dp(40)
            
        MDLabel:
            size_hint: .4, None
            height : dp(40)
            text: "Heure d'arrivée" 
        MDTextField:
            id: arrival_time
            on_text: app.activer_boutons_modification()
            size_hint: .6, None
            height : dp(40)
        
        MDLabel:
            size_hint: .4, None
            height : dp(40)
            text: "Heure de sortie"    
        MDTextField:
            id: exit_time
            on_text: app.activer_boutons_modification()
            size_hint: .6, None
            height : dp(40)
            
        MDLabel:
            size_hint: .4, None
            height : dp(40)
            text: "Observation" 
        MDTextField:
            id: observation
            on_text: app.activer_boutons_modification()
            size_hint: .6, None
            height : dp(40)
#
<AccountScreen>:
    MDTopAppBar:
        type: "small"
        pos_hint: {"top": 1}
        md_bg_color: self.theme_cls.backgroundColor

        MDTopAppBarLeadingButtonContainer:

            ToolMDActionButton:
                icon: "arrow-left"
                texte: "Retour à l'écran principal"
                on_release:
                    root.manager.current = "screen A"

        MDTopAppBarTitle:
            text: "Bienvenue dans la gestion de votre compte"
            halign: "center"
        MDTopAppBarTrailingButtonContainer:

            ToolMDActionButton:
                id: btn_save
                icon: "content-save"
                texte: "Sauvegarder les modifications"
                disabled: True
                md_bg_color: "#a7d9adff"
                theme_icon_color: "Custom"
                icon_color: "#10b480ff"
                on_release: root.update_user()
            ToolMDActionButton:
                id: btn_cancel
                icon: "cancel"
                texte: "Annuler les modifications"
                disabled: True
                md_bg_color: "#FFCDD2"
                theme_icon_color: "Custom"
                icon_color: "#C62828"
                on_release: root.annuler_modification_utilisateur()

    MDGridLayout:
        id: box
        cols: 2
        spacing: "12dp"
        padding: "12dp"
        adaptive_height: True
        size_hint_x: .7
        pos_hint: {"top": .9, "x": .05}

        MDLabel:
            text: "Nom"
            size_hint_x: .4
            size_hint_y: None
            height: dp(40)
        MDTextField:
            id: account_last_name
            size_hint_x: .6
            size_hint_y: None
            height: dp(40)
            required: True
            on_text: root.enable_butons()
        
        MDLabel:
            text: "Prenom"
            size_hint_x: .4
            size_hint_y: None
            height: dp(40)
        MDTextField:
            id: account_first_name
            size_hint_x: .6
            size_hint_y: None
            height: dp(40)
            required: True
            on_text: root.enable_butons()

        MDLabel:
            text: "Email"
            size_hint_x: .4
            size_hint_y: None
            height: dp(40)
        MDTextField:
            id: account_email
            validator: "email"
            required: True
            size_hint_x: .6
            size_hint_y: None
            height: dp(40)
            on_text: root.enable_butons()

        MDLabel:
            text: "Rôle"
            size_hint_x: .4
            size_hint_y: None
            height: dp(40)
        MDTextField:
            id: account_role
            size_hint_x: .6
            size_hint_y: None
            height: dp(40)
            required: True
            on_text: root.enable_butons()

        MDLabel:
            text: "Mot de passe"
            size_hint_x: .4
            size_hint_y: None
            height: dp(40)
        MDBoxLayout:
            orientation: "horizontal"
            spacing: "10dp"
            size_hint_x: .6
            MDTextField:
                id: account_password_first
                size_hint_y: None
                height: dp(40)
                password: True
                required: True
                on_text: root.enable_butons()
            MDIconButton:
                icon: "eye"
                on_release: app.toggle_password_visibility(self, root.ids.account_password_first)

        MDLabel:
            text: "Mot de passe à nouveau"
            size_hint_x: .4
            size_hint_y: None
            height: dp(40)
        MDBoxLayout:
            orientation: "horizontal"
            spacing: "10dp"
            size_hint_x: .6
            MDTextField:
                id: account_password_second
                size_hint_y: None
                height: dp(40)
                password: True
                required: True
                on_text: root.enable_butons()
            MDIconButton:
                icon: "eye"
                on_release: app.toggle_password_visibility(self, root.ids.account_password_second)
    
    
    MDButton:
        style: "outlined"
        pos_hint: {"center_x": 0.5, "y": 0.1}
        md_bg_color: "red"
        text_color: "white"
        on_release: root.manager.current = "login"
        MDButtonText:
            text: "Deconnexion"
        MDButtonIcon:
            icon: "logout"
#
<LoginScreen>:
    MDCard:
        style: "elevated"
        pos_hint: {"center_x": .5, "center_y": .5}
        padding: "4dp"
        size_hint: .5, .6
        # Sets custom properties.
        theme_shadow_color: "Custom"
        shadow_color: "black"
        theme_bg_color: "Custom"
        MDBoxLayout:
            orientation: "vertical"
            spacing: "10dp"
            MDLabel:
                text: "CONNEXION"
                halign: "center"

            MDTextField:
                id: login_email
                size_hint_x: .6
                pos_hint: {"center_x": 0.5}
                validator: "email"
                required: True
                MDTextFieldHintText:
                    text: "Email"
                MDTextFieldHelperText:
                    mode: "on_error"
                MDTextFieldLeadingIcon:
                    icon: "email"
            MDBoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                pos_hint: {"center_x": 0.55}
                size_hint_x: .7
                MDTextField:
                    id: login_password
                    password: True
                    required: True
                    MDTextFieldHintText:
                        text: "Mot de passe"
                    MDTextFieldHelperText:
                        mode: "on_error"
                    MDTextFieldLeadingIcon:
                        icon: "key"
                MDIconButton:
                    icon: "eye"
                    on_release: app.toggle_password_visibility(self, root.ids.login_password)

            MDButton:
                style: "text"
                pos_hint: {"center_x": 0.5}
                on_release: root.manager.current = "reset"
                MDButtonText:
                    text: "Mot de passe oublié ?"

            MDButton:
                style: "text"
                pos_hint: {"center_x": 0.5}
                on_release: root.manager.current = "signup"
                MDButtonText:
                    text: "Pas encore inscrit ? S’inscrire"
            MDButton:
                style: "elevated"
                pos_hint: {"center_x": 0.5}
                on_release: root.login()
                MDButtonText:
                    text: "Se connecter"

<SignupScreen>:
    MDCard:
        style: "elevated"
        pos_hint: {"center_x": .5, "center_y": .5}
        padding: "4dp"
        size_hint: .5, .9
        # Sets custom properties.
        theme_shadow_color: "Custom"
        shadow_color: "black"
        theme_bg_color: "Custom"
        MDBoxLayout:
            orientation: "vertical"
            spacing: "10dp"

            MDLabel:
                text: "INSCRIPTION"
                halign: "center"

            MDTextField:
                id: signup_last_name
                size_hint_x: .6
                pos_hint: {"center_x": 0.5}
                required: True
                MDTextFieldHintText:
                    text: "Nom"
                MDTextFieldLeadingIcon:
                    icon: "account"
            
            MDTextField:
                id: signup_first_name
                size_hint_x: .6
                pos_hint: {"center_x": 0.5}
                required: True
                MDTextFieldHintText:
                    text: "Prenom"
                MDTextFieldLeadingIcon:
                    icon: "account"

            MDTextField:
                id: signup_email
                validator: "email"
                required: True
                size_hint_x: .6
                pos_hint: {"center_x": 0.5}
                MDTextFieldHintText:
                    text: "Email"
                MDTextFieldHelperText:
                    mode: "on_error"
                MDTextFieldLeadingIcon:
                    icon: "email"
            
            MDBoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                pos_hint: {"center_x": 0.55}
                size_hint_x: .7
                MDTextField:
                    id: signup_password_first
                    password: True
                    required: True
                    MDTextFieldHintText:
                        text: "Mot de passe"
                    MDTextFieldHelperText:
                        text: "Minimum 8 caractères."
                    MDTextFieldLeadingIcon:
                        icon: "key"
                MDIconButton:
                    icon: "eye"
                    on_release: app.toggle_password_visibility(self, root.ids.signup_password_first)
            
            MDBoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                pos_hint: {"center_x": 0.55}
                size_hint_x: .7
                MDTextField:
                    id: signup_password_second
                    password: True
                    required: True
                    MDTextFieldHintText:
                        text: "Mot de passe à nouveau"
                    MDTextFieldLeadingIcon:
                        icon: "key"
                MDIconButton:
                    icon: "eye"
                    on_release: app.toggle_password_visibility(self, root.ids.signup_password_second)
            
            MDTextField:
                id: signup_role
                size_hint_x: .6
                pos_hint: {"center_x": 0.5}
                required: True
                MDTextFieldHintText:
                    text: "Rôle"
                MDTextFieldLeadingIcon:
                    icon: "account-cog"
                MDTextFieldHelperText:
                    text: "Entrez Huissier ou Autre"

            MDButton:
                style: "elevated"
                pos_hint: {"center_x": 0.6}
                size_hint_y: None
                height: "30dp"
                on_release: root.signup()
                MDButtonText:
                    text: "S’inscrire"

            MDButton:
                style: "text"
                pos_hint: {"center_x": 0.6}
                size_hint_y: None
                height: "30dp"
                on_release: root.manager.current = "login"
                MDButtonText:
                    text: "Déjà inscrit ? Se connecter"


<ResetPasswordScreen>:
    MDCard:
        style: "elevated"
        pos_hint: {"center_x": .5, "center_y": .5}
        padding: "4dp"
        size_hint: .5, .5
        # Sets custom properties.
        theme_shadow_color: "Custom"
        shadow_color: "black"
        theme_bg_color: "Custom"
        MDBoxLayout:
            orientation: "vertical"
            spacing: "10dp"
            MDLabel:
                text: "RÉINITIALISER LE MOT DE PASSE"
                halign: "center"

            MDTextField:
                id: reset_email
                validator: "email"
                required: True
                size_hint_x: .5
                pos_hint: {"center_x": 0.5}
                MDTextFieldHintText:
                    text: "Votre email"
                MDTextFieldHelperText:
                    mode: "on_error"
                MDTextFieldLeadingIcon:
                    icon: "email"

            MDButton:
                style: "elevated"
                pos_hint: {"center_x": 0.5}
                on_release: app.send_reset_code()
                MDButtonText:
                    text: "Envoyer le code"
            MDButton:
                style: "text"
                pos_hint: {"center_x": 0.5}
                on_release: root.manager.current = "login"
                MDButtonText:
                    text: "Vous rappelez ? Se connecter"

<CodeInputScreen>:
    MDCard:
        style: "elevated"
        pos_hint: {"center_x": .5, "center_y": .5}
        padding: "4dp"
        size_hint: .5, .5
        # Sets custom properties.
        theme_shadow_color: "Custom"
        shadow_color: "black"
        theme_bg_color: "Custom"
        MDBoxLayout:
            orientation: "vertical"
            spacing: "10dp"
            MDLabel:
                text: "Entrez le code reçu par mail"
                halign: "center"
            MDTextField:
                id: reset_code
                size_hint_x: .5
                pos_hint: {"center_x": 0.5}
                required: True
                MDTextFieldHintText:
                    text: "Code reçu par mail"
                MDTextFieldHelperText:
                    mode: "on_error"

            MDButton:
                style: "elevated"
                md_gb_color: "green"
                pos_hint: {"center_x": 0.5}
                on_release: app.check_code()
                MDButtonText:
                    text: "Valider"
            MDButton:
                style: "outlined"
                md_gb_color: "red"
                pos_hint: {"center_x": 0.5}
                on_release: app.send_reset_code()
                MDButtonText:
                    text: "Renvoyer un nouveau code"
            
            MDButton:
                style: "text"
                pos_hint: {"center_x": 0.5}
                on_release: root.manager.current = "login"
                MDButtonText:
                    text: "Retour à la connexion"

<NewPasswordScreen>:
    MDCard:
        style: "elevated"
        pos_hint: {"center_x": .5, "center_y": .5}
        padding: "4dp"
        size_hint: .5, .5
        # Sets custom properties.
        theme_shadow_color: "Custom"
        shadow_color: "black"
        theme_bg_color: "Custom"
        MDBoxLayout:
            orientation: "vertical"
            spacing: "10dp"
            MDLabel:
                text: "Définissez un nouveau Mot de passe de 8 caractères au minimum"
                halign: "center"
            MDBoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                pos_hint: {"center_x": 0.55}
                size_hint_x: .7
                MDTextField:
                    id: new_password_first
                    password: True
                    required: True
                    MDTextFieldHintText:
                        text: "Nouveau mot de passe"
                    MDTextFieldHelperText:
                        mode: "on_error"
                        text: "Minimum 8 caractères."
                    MDTextFieldLeadingIcon:
                        icon: "key"
                MDIconButton:
                    icon: "eye"
                    on_release: app.toggle_password_visibility(self, root.ids.new_password_first)

            MDBoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                pos_hint: {"center_x": 0.55}
                size_hint_x: .7
                MDTextField:
                    id: new_password_second
                    password: True
                    required: True
                    MDTextFieldHintText:
                        text: "Entrez le mot de passe encore."
                    MDTextFieldLeadingIcon:
                        icon: "key"
                MDIconButton:
                    icon: "eye"
                    on_release: app.toggle_password_visibility(self, root.ids.new_password_second)

            MDButton:
                style: "elevated"
                md_gb_color: "green"
                pos_hint: {"center_x": 0.5}
                on_release: app.reset_password()
                MDButtonText:
                    text: "Valider"
            
            MDButton:
                style: "text"
                md_gb_color: "red"
                pos_hint: {"center_x": 0.5}
                on_release: root.manager.current = "login"
                MDButtonText:
                    text: "Retour à la connexion"

#
MDScreenManager:
    md_bg_color: self.theme_cls.backgroundColor
    LoginScreen:
        name: "login"
    MainScreen:
        name: "screen A"
    DetailScreen:
        name: "screen B"
    AccountScreen:
        name: "account"
    SignupScreen:
        name: "signup"
    ResetPasswordScreen:
        name: "reset"
    CodeInputScreen:
        name: "code_input"
    NewPasswordScreen:
        name: "new_password"

#